<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar producto</title>
    <link rel="stylesheet" href="estilos.css">
</head>

<body>
    <h1>Agregar Productos al Inventario</h1>
    <h3>Codo a Codo 2023</h3>
    <form id="formulario">
        <label for="codigo">Código:</label>
        <input type="text" id="codigo" name="codigo" required><br>


        <label for="descripcion">Descripción:</label>
        <input type="text" id="descripcion" name="descripcion" required><br>


        <label for="cantidad">Cantidad:</label>
        <input type="number" id="cantidad" name="cantidad" required><br>


        <label for="precio">Precio:</label>
        <input type="number" step="0.01" id="precio" name="precio" required><br>


        <label for="contrasena">Contraseña:</label>
        <input type="password" id="contrasena" name="contrasena" required><br>


        <button type="submit">Agregar Producto</button>
        <a href="index.html">Menu principal</a>
    </form>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#formulario').submit(function(event) {
                event.preventDefault();
                var codigo = $('#codigo').val();
                var descripcion = $('#descripcion').val();
                var cantidad = $('#cantidad').val();
                var precio = $('#precio').val();
                var contrasena = $('#contrasena').val();  // Obtenemos el valor de la contraseña

                var producto = {
                    codigo: codigo,
                    descripcion: descripcion,
                    cantidad: cantidad,
                    precio: precio,
                    contrasena: contrasena  // Agregamos la contraseña al objeto del producto
                };

                $.ajax({
                    url: '/altas',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ 'contrasena': contrasena }),
                    success: function(response) {
                        // Realizamos la solicitud POST al servidor solo si la contraseña es correcta
                        $.ajax({
                            url: '/productos',
                            method: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(producto),
                            success: function(response) {
                                alert('Producto agregado correctamente.');
                                $('#codigo').val('');
                                $('#descripcion').val('');
                                $('#cantidad').val('');
                                $('#precio').val('');
                                $('#contrasena').val('');  // Limpiamos el campo de la contraseña
                            },
                            error: function(xhr, status, error) {
                                var errorMessage = JSON.parse(xhr.responseText).message;
                                alert('Error: ' + errorMessage);
                            }
                        });
                    },
                    error: function(xhr, status, error) {
                        var errorMessage = JSON.parse(xhr.responseText).message;
                        alert('Error: ' + errorMessage);
                    }
                });
            });
        });
    </script>
</body>

</html>
